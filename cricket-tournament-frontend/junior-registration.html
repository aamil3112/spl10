<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Junior Registration Form</title>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="reg-container">
        <div class="logo-container">
            <img src="res/backdrop/logo.png" alt="Logo" class="logo">
        </div>
        <div class="form-container">
            <h2>Junior Registration Form</h2>
            <form id="registrationForm" enctype="multipart/form-data">
                <label for="fullname">Full Name:</label>
                <input type="text" id="fullname" name="fullname" required>
                
                <label for="mobilenumber">Mobile Number:</label>
                <input type="tel" id="mobilenumber" name="mobilenumber" required>
                
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" required>

                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>

                <label for="passportpic">Passport Size Pic:</label>
                <input type="file" id="passportpic" name="passportpic" accept="image/*" required>

                <label for="aadhaar">Aadhaar Card:</label>
                <input type="file" id="aadhaar" name="aadhaar" accept="image/*,application/pdf" required>

                <label for="role">Playing Role:</label>
                <select id="role" name="role" required>
                    <option value="bowler">Bowler</option>
                    <option value="batsman">Batsman</option>
                    <option value="wicketkeeper">Wicketkeeper</option>
                    <option value="allrounder">Allrounder</option>
                </select>

                <label for="batting">Batting (L/R):</label>
                <select id="batting" name="batting" required>
                    <option value="left">Left</option>
                    <option value="right">Right</option>
                </select>

                <label for="bowling">Bowling Style:</label>
                <select id="bowling" name="bowling">
                    <option value="right_fast">Right Fast</option>
                    <option value="right_medium">Right Medium</option>
                    <option value="left_fast">Left Fast</option>
                    <option value="left_medium">Left Medium</option>
                    <option value="right_spin">Right Spin</option>
                    <option value="left_spin">Left Spin</option>
                </select>

                <label for="batting_order">Batting Order:</label>
                <select id="batting_order" name="batting_order" required>
                    <option value="upper">Upper</option>
                    <option value="middle">Middle</option>
                    <option value="lower">Lower</option>
                </select>

                <input type="submit" id="submitButton" value="Submit">
            </form>
        </div>
    </div>

    <script>
        // Load Razorpay script dynamically
        let script = document.createElement("script");
        script.src = "https://checkout.razorpay.com/v1/checkout.js";
        script.async = true;
        document.head.appendChild(script);

        document.getElementById("registrationForm").addEventListener("submit", async function (e) {
            e.preventDefault();
            
            document.getElementById("submitButton").value = "Processing Payment...";
            document.getElementById("submitButton").disabled = true;

            const amount = 1; // Registration fee in INR
            const currency = "INR";
        
            try {
                let orderResponse = await fetch("http://localhost:5000/create-order", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ amount, currency })
                });

                let orderData = await orderResponse.json();

                let options = {
                    key: "rzp_live_sT372ba7IgeOTD", // Replace with your Razorpay Key
                    amount: orderData.amount,
                    currency: orderData.currency,
                    name: "Cricket Tournament",
                    description: "Junior Registration Fee",
                    order_id: orderData.id,
                    handler: async function (response) {
                        let verifyResponse = await fetch("http://localhost:5000/verify-payment", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(response)
                        });

                        let verifyData = await verifyResponse.json();

                        if (verifyData.success) {
                            alert("Payment Successful! Proceeding with Registration...");
                            document.getElementById("submitButton").value = "Submit";

                            window.location.href = "index.html"; // Redirect to home page
                        } else {
                            alert("Payment Verification Failed");
                        }
                    },
                    prefill: {
                        name: document.getElementById("fullname").value,
                        email: document.getElementById("email").value,
                        contact: document.getElementById("mobilenumber").value
                    },
                    theme: {
                        color: "#3399cc"
                    }
                };

                let rzp = new Razorpay(options);
                rzp.open();

            } catch (error) {
                alert("Error processing payment: " + error.message);
            }
        });
    </script>

</body>
</html>
